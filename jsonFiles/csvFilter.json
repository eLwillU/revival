[
  {
    "file": "SCAPE-QuestionnaireResponses.csv",
    "fieldSeparator": ";",
    "multiValueSeparator": "|",
    "missingValues": "",
    "group": [
      {
        "as": "Patient",
        "key": {
          "fhir": "id"
        },
        "filter": {
          "resourceType": "Patient"
        }
      },
      {
        "as": "Q",
        "key": {
          "fhir": "subject.reference",
          "use": { "$function": "idFromRef" }
        },
        "filter": [
          {
            "resourceType": "QuestionnaireResponse",
            "status": ["in-progress", "completed", "amended"]
          }
        ],
        "sort": [
          {
            "fhir": "meta.lastUpdated",
            "descending": false
          }
        ]
      }
    ],
    "sorted": true,
    "forEach": "Q",
    "nested": {
      "forEach": "item"
    },
    "fields": [
      { "csv": "id", "fhir": "Q.id" },
      { "csv": "subject", "fhir": "Q.subject.display" },
      { "csv": "gender", "fhir": "Patient.gender" },
      { "csv": "birthDate", "fhir": "Patient.birthDate" },
      { "csv": "dateTime", "fhir": "Q.authored" },
      { "csv": "linkId", "fhir": "Q.item.linkId" },
      { "csv": "answer", "fhir": "Q.item.answer.valueCoding" }
    ]
  }
]
